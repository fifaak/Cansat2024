<!DOCTYPE html>
<html>
<head>
<title>Gyroscope Simulation (3D)</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<style>
  #container {
    width: 100%;
    height: 500px;
  }
</style>
</head>
<body>
<h1>Gyroscope Data (3D Visualization)</h1>
<div id="container"></div>

<script>
const baudRate = 115200;  

let serial;
let gyroData = []; 

function requestSerialPort() {
  navigator.serial.requestPort().then(selectedPort => {
    serial = selectedPort;
    console.log("Serial port connected");
    connectSerial();
  }).catch(error => {
    console.error("Error requesting port:", error);
  });
}

function connectSerial() {
  serial.open({ baudRate }).then(() => {
    console.log("Serial connection established!");
    const reader = serial.readable.getReader();

    function readData() {
      reader.read().then(({ value, done }) => {
        if (!done) {
          const text = new TextDecoder().decode(value);
          handleData({ data: text });  // Call handleData with received data
          readData();  // Read next chunk of data
        } else {
          console.log("Serial port closed.");
        }
      }).catch(error => {
        console.error("Error reading data:", error);
      });
    }

    readData();  
  }).catch(error => {
    console.error("Serial connection error:", error);
  });
}

function handleData(event) {
    const text = event.data;
    const values = text.trim().split(',');
    const roll = parseInt(values[0]);
    const pitch = parseInt(values[1]);
    const yaw = parseInt(values[2]);
  
    // Update visualization and text data (unchanged)
    updateGyroVisualization(roll, pitch, yaw);
    updateTextData(roll, pitch, yaw);
  }
  
  
  setInterval(handleData, 100); // Call handleData every 100ms for simulation
  

const container = document.getElementById('container');
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, container.clientWidth / container.clientHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer();
renderer.setSize(container.clientWidth, container.clientHeight);
container.appendChild(renderer.domElement);

const geometry = new THREE.SphereGeometry(1, 1, 3);
const material = new THREE.MeshLambertMaterial({ color: 0x00ff00 }); 
const sphere = new THREE.Mesh(geometry, material);
scene.add(sphere);

const ambientLight = new THREE.AmbientLight(0xcccccc, 0.5);
scene.add(ambientLight);

camera.position.z = 5;

function updateGyroVisualization() {
  if (gyroData.length > 0) {
    const { x, y, z } = gyroData[gyroData.length - 1];
    sphere.rotation.x = (Math.PI / 180) * x; 
    sphere.rotation.y = (Math.PI / 180) * y;
    sphere.rotation.z = (Math.PI / 180) * z;

    renderer.render(scene, camera);
  }
}
function updateTextData(roll, pitch, yaw) {
    document.getElementById('roll-value').textContent = roll.toFixed(2);
    document.getElementById('pitch-value').textContent = pitch.toFixed(2);
    document.getElementById('yaw-value').textContent = yaw.toFixed(2);
  }
document.querySelector('button').addEventListener('click', requestSerialPort);

</script>

<button onclick="requestSerialPort()">Request Serial Port</button>
<div id="data">

    <h2>Real-time Data</h2>
    <p>Roll: <span id="roll-value">0</span> deg</p>
    <p>Pitch: <span id="pitch-value">0</span> deg</p>
    <p>Yaw: <span id="yaw-value">0</span> deg</p>
  
  </div>
</body>
</html>
